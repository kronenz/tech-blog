---
title: "상태 머신 패턴 이해하기"
pubDate: 2025-12-05
description: "AnimFlow로 유한 상태 머신(FSM)의 상태 전이를 시각화하고 UI 상태 관리 패턴을 배웁니다."
tags: ["animflow", "state-machine", "design-pattern", "frontend"]
draft: false
---

import AnimFlowEmbed from '../../components/AnimFlowEmbed.astro';

# 상태 머신(State Machine) 패턴

복잡한 UI 상태를 관리할 때 상태 머신 패턴을 사용하면 예측 가능하고 디버깅하기 쉬운 코드를 작성할 수 있습니다.

## 로딩 상태 예시

데이터를 불러올 때의 일반적인 상태 전이를 살펴봅시다.

<AnimFlowEmbed
  id="state-machine"
  title="Loading State Machine"
  height={450}
  yaml={`version: "1.0"
nodes:
  - id: idle
    type: box
    label: Idle
    position: { x: 100, y: 200 }
  - id: loading
    type: box
    label: Loading
    position: { x: 350, y: 200 }
  - id: success
    type: box
    label: Success
    position: { x: 600, y: 120 }
  - id: error
    type: box
    label: Error
    position: { x: 600, y: 280 }
edges:
  - id: e1
    from: idle
    to: loading
    label: FETCH
  - id: e2
    from: loading
    to: success
    label: RESOLVE
  - id: e3
    from: loading
    to: error
    label: REJECT
  - id: e4
    from: error
    to: loading
    label: RETRY
  - id: e5
    from: success
    to: idle
    label: RESET
scenarios:
  - id: success-flow
    name: 성공 케이스
    steps:
      - action: highlight
        nodes: [idle]
        style:
          color: "#6b7280"
        duration: 600
      - action: animate-edge
        edge: e1
        label: "FETCH"
        duration: 500
      - action: highlight
        nodes: [loading]
        style:
          color: "#3b82f6"
        duration: 1000
      - action: animate-edge
        edge: e2
        label: "RESOLVE"
        duration: 500
      - action: highlight
        nodes: [success]
        style:
          color: "#4ade80"
        duration: 800
  - id: error-retry-flow
    name: 에러 후 재시도
    steps:
      - action: highlight
        nodes: [idle]
        style:
          color: "#6b7280"
        duration: 400
      - action: animate-edge
        edge: e1
        label: "FETCH"
        duration: 500
      - action: highlight
        nodes: [loading]
        style:
          color: "#3b82f6"
        duration: 800
      - action: animate-edge
        edge: e3
        label: "REJECT"
        duration: 500
      - action: highlight
        nodes: [error]
        style:
          color: "#f87171"
        duration: 600
      - action: animate-edge
        edge: e4
        label: "RETRY"
        duration: 500
      - action: highlight
        nodes: [loading]
        style:
          color: "#3b82f6"
        duration: 800
      - action: animate-edge
        edge: e2
        label: "RESOLVE"
        duration: 500
      - action: highlight
        nodes: [success]
        style:
          color: "#4ade80"
        duration: 800`}
/>

## 상태 머신의 장점

### 1. 명시적인 상태
모든 가능한 상태가 명시적으로 정의되어 있어 예상치 못한 상태를 방지합니다.

### 2. 유효한 전이만 허용
현재 상태에서 가능한 전이만 허용하여 버그를 예방합니다.

### 3. 시각화 가능
위 다이어그램처럼 상태 흐름을 시각적으로 이해할 수 있습니다.

## TypeScript 구현 예시

```typescript
type State = 'idle' | 'loading' | 'success' | 'error';
type Event = 'FETCH' | 'RESOLVE' | 'REJECT' | 'RETRY' | 'RESET';

interface StateMachine {
  state: State;
  data: unknown | null;
  error: Error | null;
}

function reducer(machine: StateMachine, event: Event): StateMachine {
  switch (machine.state) {
    case 'idle':
      if (event === 'FETCH') {
        return { state: 'loading', data: null, error: null };
      }
      break;
    case 'loading':
      if (event === 'RESOLVE') {
        return { ...machine, state: 'success' };
      }
      if (event === 'REJECT') {
        return { ...machine, state: 'error' };
      }
      break;
    case 'error':
      if (event === 'RETRY') {
        return { state: 'loading', data: null, error: null };
      }
      if (event === 'RESET') {
        return { state: 'idle', data: null, error: null };
      }
      break;
  }
  return machine;
}
```

상태 머신 라이브러리인 XState를 사용하면 더욱 강력한 상태 관리가 가능합니다.
