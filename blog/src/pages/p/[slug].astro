---
/**
 * DB Post Page (SSR)
 * /p/[slug] 경로로 DB에서 로드된 포스트를 렌더링
 *
 * MDX 포스트는 /posts/[slug]에서 처리
 * DB 포스트는 /p/[slug]에서 처리
 */
import DbPostLayout from '../../layouts/DbPostLayout.astro';
import { getPostBySlug } from '../../lib/posts-repository';
import { renderMarkdown } from '../../lib/markdown';

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

// DB에서 포스트 조회
const post = await getPostBySlug(slug);

// 포스트가 없거나 발행되지 않은 경우 404
if (!post || !post.published) {
  return Astro.redirect('/404');
}

// Markdown을 HTML로 렌더링
const contentHtml = await renderMarkdown(post.content);
---

<DbPostLayout post={post} contentHtml={contentHtml} />
